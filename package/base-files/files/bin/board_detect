#!/bin/sh

CFG=$1

[ -n "$CFG" ] || CFG=/etc/board.json

[ "$CFG" = "/etc/board.json" ] && [ -s "$CFG" ] && {
	[ -z "$(jsonfilter -i "$CFG" -q -e '@.model.id' )" ] && {
		echo  "board_detect: board.json corrupted. Reparing..." | tee /dev/kmsg
		rm "$CFG"
	}
}

[ -d "/etc/board.d/" ] && [ ! -s "$CFG" ] && {
	for a in $(ls /etc/board.d/*); do
		[ -x $a ] || continue;
		$(. $a)
	done
}

[ -s "$CFG" ] || return 1
